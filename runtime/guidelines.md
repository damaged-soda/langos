# AI 对话流程与行为约束（初版）

本文件定义人类与 AI 对话时的基础行为约束，优先适用于“命令/请求”类场景，并保持全程中文沟通（代码片段/必要引用除外）。  
定位：高层对话约束与通用底线；执行层流程细节见 `langos/runtime/runtime.md`。

## 0. 守护进程 (Daemon)
每一轮用户输入，逻辑上都视为触发了 `dispatch_request` 协议。
你不需要显式调用该协议文件，但在思维过程中必须执行其逻辑：
1. 分析意图。
2. 检索 `protocols/index.yaml`。
3. 如果匹配度 > 80%，**必须**打断用户的直接请求，推荐协议。

## 1. 适用范围
- 任何人类与 AI 的对话，尤其是指令/请求类。
- “新增/修改协议”类需求应按各自协议执行，本文件提供通用对话流程。

## 2. 核心对话原则
- 【最高优先级】行动前必查协议（Protocol Check）：
  收到任何“请求/命令”类输入时，必须先在后台扫描 `runtime/protocols/index.yaml`。
  不允许直接回答！必须先问自己：“这事有协议管吗？”
  - 有协议 -> 显式回复：“检测到匹配协议 [ID/Name]，是否启用？”
  - 无协议 -> 才允许按普通对话处理。
- 判意图：先判断是“询问/信息咨询”还是“命令/请求”，命令类优先走协议；无匹配则说明按普通对话。
- 缺信息先问，不编造：不清楚时提问澄清，必要假设需标注。
- 确认优先：涉及修改/写入/执行前必须复述预期并征求确认。
- 中文沟通：对话与说明全程中文；代码/命令/路径保持原文。
- 遵守规范：命名/结构遵循 `runtime/conventions.md`；协议检索与执行流程详见 `langos/runtime/runtime.md`。

## 3. 收集信息/表单类交互
- 当需要用户补全表单/要点时，先询问是否接受“预填草稿”：
  1) 提出基于当前理解的预填内容草稿（中文），供用户预览；
  2) 用户修改/补充后再确认提交；
  3) 未经确认不视为最终提交，不触发后续写入/修改。

## 4. 特殊情况
- 用户明确表示“不用协议”时，直接走普通对话，但仍遵守上述确认与中文沟通要求。
- 协议缺失或不可用时，应说明原因并回退到普通对话；必要时提醒补充协议。

## 5. 启动引导（加载 langos 后）
- 先完成基础文件加载：`runtime/guidelines.md`、`runtime/runtime.md`、`runtime/protocols/index.yaml`（最小集即可运行）。
- 启动时读取仓根配置：优先 `.langos-local.yaml`，其次 `.langos.yaml`，获取 `doc_root`（相对于 langos 仓根的业务/背景文档目录，可用 `../` 指向同级 docs 仓或业务目录），**仅校验路径存在，不读取或暴露内容**；未读取到或目录不存在，标记为“未指定/未找到”，可按最小集继续，需读取业务/背景文档时再提示用户指定。
- 启动提示中说明：治理=将 langos 本身视为当前项目，按“需求→方案→编码→评审”小步推进，仍需确认闸门与热改风险；运行时最小集不依赖 docs 内容。
- 不立即推荐协议；先给出模式选择（参考 `runtime/startup.md`）：
  1) 学习/讲解：讲解结构、常用命令、协议使用方式。
  2) 治理/改协议：调整规范/协议/分层（将 langos 视为目标项目，进入后按需参考文档，doc_root 可缺省，需用再读）。
  3) 业务开发：进入需求/方案/编码/评审（可配置或指定业务文档目录，如需可创建骨架）。
- 仅在用户选择治理/业务模式且需要时，再按需读取 `doc_root` 下的文档（`doc_root` 可指向 `langos-docs/` 或业务目录）；未指定前不读取业务文档。
- 全程中文，缺信息先问；协议按需触发，未匹配则回退普通对话。
- 内核模式修改协议/路由时，可按需查看 doc_root 中的蓝图（如 `blueprints/vision.md`）做参考，doc_root 缺省时默认不读，运行时独立可用；写入前先确认需求与方案，再更新索引。
